{% extends "base.html" %}
{% block title %}Login â€” VulnMap{% endblock %}
{% block content %}

<!-- Auth card -->
<div class="card rtl" style="max-width:560px;margin-inline:auto;overflow:hidden;">
  <!-- Decorative bar -->
  <div aria-hidden="true" style="height:6px;border-radius:8px;background:linear-gradient(90deg,#4e7cff,#59d7ff,#6fffc3);opacity:.4;margin:-4px 0 8px;"></div>

  <h2 style="margin-bottom:6px;">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
  <p class="small muted" style="margin-top:0;">
    Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ….
  </p>

  <!-- Subtle tips -->
  <div class="card elev" style="margin-top:10px;">
    <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap;">
      <span class="chip">ğŸ”’ Ø¬Ù„Ø³Ø© Ø¢Ù…Ù†Ø©</span>
      <span class="chip" style="background:#2a2320;color:#f4d6c5;border-color:#5b3e33;">âš ï¸ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¹Ø¯Ù… Ù…Ø´Ø§Ø±ÙƒØ© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„</span>
    </div>
  </div>

  <form id="login-form" method="post" action="{{ url_for('login') }}" style="display:grid;gap:12px;margin-top:14px;">
    <!-- Username -->
    <div>
      <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
      <div style="position:relative;">
        <input class="input" id="username" type="text" name="username" required autocomplete="username" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" autofocus>
        <div aria-hidden="true" style="position:absolute;inset-inline-start:10px;top:50%;transform:translateY(-50%);opacity:.65;">ğŸ‘¤</div>
      </div>
    </div>

    <!-- Password with toggle + caps-lock hint -->
    <div>
      <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
      <div style="position:relative;display:flex;align-items:center;">
        <input class="input" id="password" type="password" name="password" required autocomplete="current-password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" style="padding-inline-end:44px;">
        <button type="button" id="togglePw" class="btn tertiary small" style="position:absolute;inset-inline-end:6px;top:50%;transform:translateY(-50%);padding:4px 10px;">
          Ø¥Ø¸Ù‡Ø§Ø±
        </button>
      </div>
      <div id="caps-hint" class="small muted" style="margin-top:6px;display:none;color:#ffd2d6;">
        ØªØ­Ø°ÙŠØ±: Ù…ÙØªØ§Ø­ <strong>Caps Lock</strong> Ù…ÙÙØ¹Ù„.
      </div>
    </div>

    <!-- Remember me (client-only) -->
    <div style="display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap;">
      <label class="small muted" style="display:flex;align-items:center;gap:8px;cursor:pointer;">
        <input id="remember" type="checkbox" style="accent-color:#2a6fff;">
        ØªØ°ÙƒØ±Ù†ÙŠ Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ø¬Ù‡Ø§Ø²
      </label>
      <a class="btn secondary small" href="{{ url_for('signup') }}">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</a>
    </div>

    <!-- Actions -->
    <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap;">
      <button class="btn" type="submit" id="submitBtn">Ø¯Ø®ÙˆÙ„</button>
      <span class="small muted">Ù‡Ù„ Ù†Ø³ÙŠØª ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±ØŸ ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©.</span>
    </div>
  </form>
</div>

{% endblock %}

{% block scripts %}
<script>
  (function () {
    var form = document.getElementById('login-form');
    var user = document.getElementById('username');
    var pw = document.getElementById('password');
    var toggle = document.getElementById('togglePw');
    var capsHint = document.getElementById('caps-hint');
    var remember = document.getElementById('remember');
    var submitBtn = document.getElementById('submitBtn');

    // Restore remembered username (client-only)
    try {
      var saved = localStorage.getItem('vm_login_username');
      if (saved && !user.value) user.value = saved;
      remember.checked = !!saved;
    } catch(e) {}

    // Show/Hide password
    if (toggle && pw) {
      toggle.addEventListener('click', function(){
        var show = pw.type === 'password';
        pw.type = show ? 'text' : 'password';
        toggle.textContent = show ? 'Ø¥Ø®ÙØ§Ø¡' : 'Ø¥Ø¸Ù‡Ø§Ø±';
        pw.focus();
      });
    }

    // Caps Lock indicator
    function onKey(e){
      try {
        var hasCaps = e.getModifierState && e.getModifierState('CapsLock');
        capsHint.style.display = hasCaps ? '' : 'none';
      } catch(_) {}
    }
    pw && pw.addEventListener('keyup', onKey);
    pw && pw.addEventListener('keydown', onKey);

    // Remember me (stores username locally only)
    form && form.addEventListener('submit', function(){
      // Optional global progress overlay (from base.html helpers)
      if (window.VM && VM.progress && submitBtn) {
        VM.progress.show('Ø¬Ø§Ø±Ù ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„â€¦', 'ÙŠØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„.');
      }
      try {
        if (remember && remember.checked) {
          localStorage.setItem('vm_login_username', user.value.trim());
        } else {
          localStorage.removeItem('vm_login_username');
        }
      } catch(e) {}
      // Let the form submit normally
    });
  })();

</script>
  <script defer src="{{ url_for('static', filename='js/index_login.js') }}"></script>
  <script>
    /* keep your current inline login helpers here (show/hide password, caps, remember me)â€¦ */
  </script>
{% endblock %}


